#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Universal Python App Builder - ÙŠØ­ÙˆÙ„ Ø£ÙŠ ÙƒÙˆØ¯ Ø¨Ø§ÙŠØ«ÙˆÙ† Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„ÙƒÙ„ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©
"""

import os
import sys
import json
import shutil
import platform
import subprocess
import zipfile
import tarfile
from pathlib import Path
from datetime import datetime
from typing import Dict, List, Optional, Tuple

class UniversalAppBuilder:
    """Ø£Ø¯Ø§Ø© Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø´Ø§Ù…Ù„Ø© Ù„ÙƒÙ„ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©"""
    
    def __init__(self, config_file: str = "app_builder_config.json"):
        self.config_file = config_file
        self.config = self.load_config()
        self.current_os = platform.system().lower()
        self.project_root = Path.cwd()
        
        # Ø£Ù„ÙˆØ§Ù† Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©
        self.COLORS = {
            'RED': '\033[91m',
            'GREEN': '\033[92m',
            'YELLOW': '\033[93m',
            'BLUE': '\033[94m',
            'MAGENTA': '\033[95m',
            'CYAN': '\033[96m',
            'RESET': '\033[0m',
            'BOLD': '\033[1m'
        }
    
    def color_print(self, text: str, color: str = 'RESET'):
        """Ø·Ø¨Ø§Ø¹Ø© Ù…Ù„ÙˆÙ†Ø©"""
        print(f"{self.COLORS.get(color, '')}{text}{self.COLORS['RESET']}")
    
    def load_config(self) -> Dict:
        """ØªØ­Ù…ÙŠÙ„ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡"""
        default_config = {
            "app_name": "MyPythonApp",
            "version": "1.0.0",
            "author": "Python Developer",
            "description": "Python Application Built with Universal Builder",
            "entry_point": "main.py",
            "icon": {
                "windows": "icon.ico",
                "linux": "icon.png",
                "macos": "icon.icns",
                "android": "icon.png"
            },
            "requirements": ["requirements.txt"],
            "include_files": ["data/", "images/", "sounds/", "fonts/"],
            "exclude_patterns": ["__pycache__", "*.pyc", ".git", ".vscode"],
            "build_targets": ["windows", "linux", "android", "macos", "web"],
            "build_options": {
                "windows": {
                    "onefile": True,
                    "console": False,
                    "uac_admin": False,
                    "create_msi": True
                },
                "linux": {
                    "onefile": True,
                    "console": True,
                    "create_appimage": True,
                    "create_deb": False,
                    "create_rpm": False
                },
                "android": {
                    "api_level": 29,
                    "orientation": "portrait",
                    "permissions": ["INTERNET", "VIBRATE"]
                },
                "macos": {
                    "onefile": True,
                    "console": False,
                    "create_dmg": True,
                    "bundle_id": "com.yourcompany.app"
                }
            }
        }
        
        if os.path.exists(self.config_file):
            try:
                with open(self.config_file, 'r', encoding='utf-8') as f:
                    user_config = json.load(f)
                    default_config.update(user_config)
            except:
                self.color_print(f"âš ï¸  Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© {self.config_file}, Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠØ©", "YELLOW")
        
        return default_config
    
    def check_dependencies(self):
        """Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ«Ø¨ÙŠØª Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©"""
        required_tools = {
            "pyinstaller": ["pyinstaller", "--version"],
            "python": ["python", "--version"],
            "git": ["git", "--version"],
            "docker": ["docker", "--version"]
        }
        
        missing_tools = []
        
        for tool, cmd in required_tools.items():
            try:
                subprocess.run(cmd, capture_output=True, check=True)
                self.color_print(f"âœ“ {tool} Ù…Ø«Ø¨Øª", "GREEN")
            except:
                missing_tools.append(tool)
                self.color_print(f"âœ— {tool} ØºÙŠØ± Ù…Ø«Ø¨Øª", "RED")
        
        return missing_tools
    
    def install_dependencies(self, missing_tools: List[str]):
        """ØªØ«Ø¨ÙŠØª Ø§Ù„Ø£Ø¯ÙˆØ§Øª Ø§Ù„Ù…ÙÙ‚ÙˆØ¯Ø©"""
        for tool in missing_tools:
            self.color_print(f"ğŸ“¦ Ø¬Ø§Ø±ÙŠ ØªØ«Ø¨ÙŠØª {tool}...", "CYAN")
            
            try:
                if tool == "pyinstaller":
                    subprocess.run([sys.executable, "-m", "pip", "install", "pyinstaller"], check=True)
                elif tool == "git" and self.current_os == "linux":
                    subprocess.run(["sudo", "apt-get", "install", "git", "-y"], check=True)
                elif tool == "docker" and self.current_os == "linux":
                    subprocess.run(["sudo", "apt-get", "install", "docker.io", "-y"], check=True)
                
                self.color_print(f"âœ“ ØªÙ… ØªØ«Ø¨ÙŠØª {tool} Ø¨Ù†Ø¬Ø§Ø­", "GREEN")
            except Exception as e:
                self.color_print(f"âŒ ÙØ´Ù„ ØªØ«Ø¨ÙŠØª {tool}: {e}", "RED")
    
    def build_for_windows(self):
        """Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ù„Ù†Ø¸Ø§Ù… Windows"""
        self.color_print("\nğŸªŸ Ø¬Ø§Ø±ÙŠ Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Windows...", "CYAN")
        
        build_dir = self.project_root / "build" / "windows"
        build_dir.mkdir(parents=True, exist_ok=True)
        
        pyinstaller_cmd = [
            sys.executable, "-m", "pyinstaller",
            "--name", f"{self.config['app_name']}-{self.config['version']}",
            "--distpath", str(build_dir / "dist"),
            "--workpath", str(build_dir / "build"),
            "--specpath", str(build_dir),
            "--clean"
        ]
        
        # Ø¥Ø¶Ø§ÙØ© Ø®ÙŠØ§Ø±Ø§Øª Windows
        opts = self.config["build_options"]["windows"]
        if opts.get("onefile", True):
            pyinstaller_cmd.append("--onefile")
        
        if not opts.get("console", False):
            pyinstaller_cmd.append("--windowed")
        
        if opts.get("uac_admin", False):
            pyinstaller_cmd.append("--uac-admin")
        
        # Ø¥Ø¶Ø§ÙØ© Ø£ÙŠÙ‚ÙˆÙ†Ø©
        icon = self.config["icon"].get("windows")
        if icon and os.path.exists(icon):
            pyinstaller_cmd.extend(["--icon", icon])
        
        # Ø¥Ø¶Ø§ÙØ© Ù…Ù„ÙØ§Øª Ø¥Ø¶Ø§ÙÙŠØ©
        for inc_file in self.config["include_files"]:
            if os.path.exists(inc_file):
                pyinstaller_cmd.extend(["--add-data", f"{inc_file}{os.pathsep}{inc_file}"])
        
        # Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
        pyinstaller_cmd.append(self.config["entry_point"])
        
        # ØªÙ†ÙÙŠØ° PyInstaller
        try:
            self.color_print(f"ğŸ—ï¸  Ø£Ù…Ø± Ø§Ù„Ø¨Ù†Ø§Ø¡: {' '.join(pyinstaller_cmd)}", "BLUE")
            subprocess.run(pyinstaller_cmd, check=True)
            
            # Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù MSI (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            if opts.get("create_msi", False) and shutil.which("candle") and shutil.which("light"):
                self.create_windows_msi(build_dir)
            
            self.color_print("âœ… ØªÙ… Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Windows Ø¨Ù†Ø¬Ø§Ø­!", "GREEN")
            return True
        except Exception as e:
            self.color_print(f"âŒ ÙØ´Ù„ Ø¨Ù†Ø§Ø¡ Windows: {e}", "RED")
            return False
    
    def build_for_linux(self):
        """Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ù„Ù†Ø¸Ø§Ù… Linux"""
        self.color_print("\nğŸ§ Ø¬Ø§Ø±ÙŠ Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Linux...", "CYAN")
        
        build_dir = self.project_root / "build" / "linux"
        build_dir.mkdir(parents=True, exist_ok=True)
        
        # Ø¨Ù†Ø§Ø¡ Ù…Ø¹ PyInstaller
        pyinstaller_cmd = [
            sys.executable, "-m", "pyinstaller",
            "--name", self.config["app_name"].lower().replace(" ", "-"),
            "--distpath", str(build_dir / "dist"),
            "--workpath", str(build_dir / "build"),
            "--specpath", str(build_dir),
            "--clean"
        ]
        
        opts = self.config["build_options"]["linux"]
        if opts.get("onefile", True):
            pyinstaller_cmd.append("--onefile")
        
        if not opts.get("console", True):
            pyinstaller_cmd.append("--windowed")
        
        # Ø£ÙŠÙ‚ÙˆÙ†Ø© Linux
        icon = self.config["icon"].get("linux")
        if icon and os.path.exists(icon):
            pyinstaller_cmd.extend(["--icon", icon])
        
        pyinstaller_cmd.append(self.config["entry_point"])
        
        try:
            subprocess.run(pyinstaller_cmd, check=True)
            
            # Ø¥Ù†Ø´Ø§Ø¡ AppImage (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            if opts.get("create_appimage", False):
                self.create_appimage(build_dir)
            
            # Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© DEB (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            if opts.get("create_deb", False):
                self.create_deb_package(build_dir)
            
            self.color_print("âœ… ØªÙ… Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Linux Ø¨Ù†Ø¬Ø§Ø­!", "GREEN")
            return True
        except Exception as e:
            self.color_print(f"âŒ ÙØ´Ù„ Ø¨Ù†Ø§Ø¡ Linux: {e}", "RED")
            return False
    
    def build_for_android(self):
        """Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ù„Ù†Ø¸Ø§Ù… Android"""
        self.color_print("\nğŸ¤– Ø¬Ø§Ø±ÙŠ Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Android...", "CYAN")
        
        build_dir = self.project_root / "build" / "android"
        build_dir.mkdir(parents=True, exist_ok=True)
        
        # Ø·Ø±ÙŠÙ‚Ø© 1: Ø§Ø³ØªØ®Ø¯Ø§Ù… Buildozer (Ù„Ù„Ø£ÙƒÙˆØ§Ø¯ Ø§Ù„Ø¨Ø³ÙŠØ·Ø©)
        if os.path.exists("buildozer.spec") or self.create_buildozer_spec(build_dir):
            try:
                subprocess.run(["buildozer", "android", "debug"], cwd=self.project_root, check=True)
                self.color_print("âœ… ØªÙ… Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Android Ø¨Ù†Ø¬Ø§Ø­ Ù…Ø¹ Buildozer!", "GREEN")
                return True
            except:
                self.color_print("âš ï¸  Buildozer ÙØ´Ù„ØŒ Ø¬Ø±Ø¨ Ø·Ø±ÙŠÙ‚Ø© Kivy", "YELLOW")
        
        # Ø·Ø±ÙŠÙ‚Ø© 2: Ø§Ø³ØªØ®Ø¯Ø§Ù… Kivy Ù…Ø¹ Docker
        self.color_print("ğŸ”§ Ø§Ø³ØªØ®Ø¯Ø§Ù… Kivy + Docker Ù„Ø¨Ù†Ø§Ø¡ Android...", "BLUE")
        
        dockerfile_content = f"""
FROM ubuntu:20.04

ENV DEBIAN_FRONTEND=noninteractive

# ØªØ«Ø¨ÙŠØª Ø§Ù„Ù…ØªØ·Ù„Ø¨Ø§Øª
RUN apt-get update && apt-get install -y \\
    python3 python3-pip git zip unzip openjdk-11-jdk \\
    autoconf libtool pkg-config zlib1g-dev libncurses5-dev \\
    libncursesw5-dev libtinfo5 cmake libffi-dev libssl-dev

# ØªØ«Ø¨ÙŠØª Buildozer
RUN pip3 install --upgrade pip wheel setuptools
RUN pip3 install buildozer cython==0.29.19

# Ù†Ø³Ø® Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
WORKDIR /app
COPY . /app

# Ø¨Ù†Ø§Ø¡ Android APK
CMD ["buildozer", "android", "debug"]
"""
        
        dockerfile_path = build_dir / "Dockerfile"
        dockerfile_path.write_text(dockerfile_content)
        
        try:
            subprocess.run([
                "docker", "build", "-t", "android-builder", "-f", str(dockerfile_path), "."
            ], check=True)
            
            subprocess.run([
                "docker", "run", "--rm",
                "-v", f"{self.project_root}:/app",
                "android-builder"
            ], check=True)
            
            self.color_print("âœ… ØªÙ… Ø¨Ù†Ø§Ø¡ APK Ù„Ù€ Android!", "GREEN")
            return True
        except Exception as e:
            self.color_print(f"âŒ ÙØ´Ù„ Ø¨Ù†Ø§Ø¡ Android: {e}", "RED")
            self.color_print("ğŸ’¡ Ù†ØµÙŠØ­Ø©: Ù‚Ù… Ø¨ØªØ«Ø¨ÙŠØª Buildozer ÙŠØ¯ÙˆÙŠØ§Ù‹", "YELLOW")
            return False
    
    def build_for_macos(self):
        """Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ Ù„Ù†Ø¸Ø§Ù… macOS"""
        self.color_print("\nğŸ Ø¬Ø§Ø±ÙŠ Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ macOS...", "CYAN")
        
        if self.current_os != "darwin":
            self.color_print("âš ï¸  Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚Ø§Øª macOS ÙŠØªØ·Ù„Ø¨ Ø¬Ù‡Ø§Ø² Mac", "YELLOW")
            return False
        
        build_dir = self.project_root / "build" / "macos"
        build_dir.mkdir(parents=True, exist_ok=True)
        
        # Ø§Ø³ØªØ®Ø¯Ø§Ù… py2app
        setup_content = f"""
from setuptools import setup

APP = ['{self.config['entry_point']}']
DATA_FILES = []

OPTIONS = {{
    'argv_emulation': False,
    'iconfile': '{self.config["icon"].get("macos", "icon.icns")}',
    'plist': {{
        'CFBundleName': '{self.config["app_name"]}',
        'CFBundleDisplayName': '{self.config["app_name"]}',
        'CFBundleVersion': '{self.config["version"]}',
        'CFBundleIdentifier': 'com.{self.config["author"].lower().replace(" ", "")}.{self.config["app_name"].lower().replace(" ", "")}',
    }}
}}

setup(
    app=APP,
    data_files=DATA_FILES,
    options={{'py2app': OPTIONS}},
    setup_requires=['py2app'],
)
"""
        
        setup_path = build_dir / "setup.py"
        setup_path.write_text(setup_content)
        
        try:
            subprocess.run([sys.executable, str(setup_path), "py2app"], cwd=build_dir, check=True)
            
            # Ø¥Ù†Ø´Ø§Ø¡ DMG (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
            opts = self.config["build_options"]["macos"]
            if opts.get("create_dmg", False):
                self.create_macos_dmg(build_dir)
            
            self.color_print("âœ… ØªÙ… Ø¨Ù†Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ macOS Ø¨Ù†Ø¬Ø§Ø­!", "GREEN")
            return True
        except Exception as e:
            self.color_print(f"âŒ ÙØ´Ù„ Ø¨Ù†Ø§Ø¡ macOS: {e}", "RED")
            return False
    
    def build_for_web(self):
        """ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¥Ù„Ù‰ ØªØ·Ø¨ÙŠÙ‚ ÙˆÙŠØ¨"""
        self.color_print("\nğŸŒ Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¥Ù„Ù‰ ÙˆÙŠØ¨...", "CYAN")
        
        build_dir = self.project_root / "build" / "web"
        build_dir.mkdir(parents=True, exist_ok=True)
        
        # Ø¥Ù†Ø´Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ ÙˆÙŠØ¨ Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Streamlit Ø£Ùˆ Gradio
        web_app_content = f"""#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import streamlit as st
import gradio as gr
import json
import os

st.set_page_config(
    page_title="{self.config['app_name']}",
    page_icon="ğŸš€",
    layout="wide"
)

# ÙˆØ§Ø¬Ù‡Ø© Streamlit
def streamlit_app():
    st.title("ğŸ¯ {self.config['app_name']}")
    st.markdown("{self.config['description']}")
    
    with st.sidebar:
        st.header("Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª")
        language = st.selectbox("Ø§Ù„Ù„ØºØ©", ["Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©", "English"])
        theme = st.selectbox("Ø§Ù„Ø³Ù…Ø©", ["ÙØ§ØªØ­", "Ø¯Ø§ÙƒÙ†"])
    
    # Ù…Ø­Ø§ÙƒØ§Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø£ØµÙ„ÙŠ
    col1, col2 = st.columns(2)
    
    with col1:
        phone = st.text_input("ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ", placeholder="+966501234567")
        message = st.text_area("âœï¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø©", height=100)
        
        if st.button("ğŸš€ Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©", type="primary"):
            if phone and message:
                st.success(f"ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ {{phone}}")
                # Ø­ÙØ¸ ÙÙŠ JSON
                data = {{"phone": phone, "message": message}}
                with open("messages.json", "a") as f:
                    json.dump(data, f)
                    f.write("\\n")
            else:
                st.error("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ù…Ù„Ø¡ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø­Ù‚ÙˆÙ„")
    
    with col2:
        st.info("ğŸ“Š Ø³Ø¬Ù„ Ø§Ù„Ø¥Ø±Ø³Ø§Ù„")
        if os.path.exists("messages.json"):
            with open("messages.json", "r") as f:
                lines = f.readlines()
                for line in lines[-10:]:  # Ø¢Ø®Ø± 10 Ø±Ø³Ø§Ø¦Ù„
                    try:
                        data = json.loads(line.strip())
                        st.write(f"**Ø±Ù‚Ù…:** {{data.get('phone')}}")
                        st.write(f"**Ø±Ø³Ø§Ù„Ø©:** {{data.get('message')[:50]}}...")
                        st.divider()
                    except:
                        pass

# ÙˆØ§Ø¬Ù‡Ø© Gradio Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø©
def gradio_app():
    with gr.Blocks(title="{self.config['app_name']}") as demo:
        gr.Markdown("# ğŸ¯ {self.config['app_name']}")
        gr.Markdown("{self.config['description']}")
        
        with gr.Row():
            with gr.Column():
                phone = gr.Textbox(label="ğŸ“ Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ")
                message = gr.Textbox(label="âœï¸ Ø§Ù„Ø±Ø³Ø§Ù„Ø©", lines=3)
                send_btn = gr.Button("ğŸš€ Ø¥Ø±Ø³Ø§Ù„", variant="primary")
                
                output = gr.Textbox(label="Ø§Ù„Ù†ØªÙŠØ¬Ø©", interactive=False)
                
                def send_message(p, m):
                    return f"âœ… ØªÙ… Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ {{p}}\\nğŸ“: {{m}}"
                
                send_btn.click(
                    send_message,
                    inputs=[phone, message],
                    outputs=[output]
                )
    
    return demo

if __name__ == "__main__":
    # Ø§Ø®ØªØ± Ø¥Ù…Ø§ Streamlit Ø£Ùˆ Gradio
    import sys
    if len(sys.argv) > 1 and sys.argv[1] == "--gradio":
        app = gradio_app()
        app.launch()
    else:
        streamlit_app()
"""
        
        web_file = build_dir / "web_app.py"
        web_file.write_text(web_app_content)
        
        # Ø¥Ù†Ø´Ø§Ø¡ requirements Ù„Ù„ÙˆÙŠØ¨
        web_reqs = build_dir / "requirements_web.txt"
        web_reqs.write_text("""streamlit>=1.24.0
gradio>=3.40.0
pandas>=2.0.0
numpy>=1.24.0
pillow>=9.5.0
""")
        
        self.color_print("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ØªØ·Ø¨ÙŠÙ‚ ÙˆÙŠØ¨ Ø¨Ù†Ø¬Ø§Ø­!", "GREEN")
        self.color_print(f"ğŸ“ Ø§Ù„Ù…ÙˆÙ‚Ø¹: {web_file}", "BLUE")
        self.color_print("ğŸ’¡ ØªØ´ØºÙŠÙ„: streamlit run web_app.py", "CYAN")
        
        return True
    
    def create_buildozer_spec(self, build_dir: Path) -> bool:
        """Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„Ù buildozer.spec Ù„Ù€ Android"""
        spec_content = f"""[app]

# Ø§Ø³Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
title = {self.config['app_name']}

# Ø§Ø³Ù… Ø§Ù„Ø­Ø²Ù…Ø© (ÙŠØ¬Ø¨ Ø£Ù† ÙŠÙƒÙˆÙ† ÙØ±ÙŠØ¯Ø§Ù‹)
package.name = {self.config['app_name'].lower().replace(' ', '')}

# Ø§Ø³Ù… Ø§Ù„Ù…Ø¬Ø§Ù„ (Ø¹ÙƒØ³ Ø§Ø³Ù… Ø§Ù„Ù…ÙˆÙ‚Ø¹)
package.domain = com.{self.config['author'].lower().replace(' ', '')}

# Ù…Ø³Ø§Ø± Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
source.dir = .

# Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ
source.include_exts = py,png,jpg,kv,atlas,json,txt

# Ø¥ØµØ¯Ø§Ø± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
version = {self.config['version']}

# Ù…ØªØ·Ù„Ø¨Ø§Øª Ø¨Ø§ÙŠØ«ÙˆÙ†
requirements = python3,kivy

# Ø¥ØµØ¯Ø§Ø± Android SDK
android.api = 29
android.minapi = 21
android.sdk = 24
android.ndk = 23b

# Ø£Ø°ÙˆÙ†Ø§Øª Android
android.permissions = INTERNET, VIBRATE

# Ø§ØªØ¬Ø§Ù‡ Ø§Ù„Ø´Ø§Ø´Ø©
orientation = portrait

# Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
icon.filename = {self.config['icon'].get('android', 'icon.png')}

# Ù†Ø³Ø® OS
osx.python_version = 3
osx.kivy_version = 2.1.0

# Ù†Ø³Ø® iOS
ios.kivy_version = 2.1.0
"""
        
        spec_path = self.project_root / "buildozer.spec"
        spec_path.write_text(spec_content)
        
        return True
    
    def create_appimage(self, build_dir: Path):
        """Ø¥Ù†Ø´Ø§Ø¡ AppImage Ù„Ù€ Linux"""
        self.color_print("ğŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ AppImage...", "BLUE")
        
        app_dir = build_dir / f"{self.config['app_name']}.AppDir"
        app_dir.mkdir(exist_ok=True)
        
        # Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙŠÙƒÙ„ AppImage
        (app_dir / "usr" / "bin").mkdir(parents=True, exist_ok=True)
        (app_dir / "usr" / "share" / "applications").mkdir(parents=True, exist_ok=True)
        (app_dir / "usr" / "share" / "icons" / "hicolor" / "256x256" / "apps").mkdir(parents=True, exist_ok=True)
        
        # Ù†Ø³Ø® Ø§Ù„ØªÙ†ÙÙŠØ°ÙŠ
        exe_source = build_dir / "dist" / self.config["app_name"].lower().replace(" ", "-")
        if exe_source.exists():
            shutil.copy(exe_source, app_dir / "usr" / "bin" / "AppRun")
            os.chmod(app_dir / "usr" / "bin" / "AppRun", 0o755)
        
        # Ø¥Ù†Ø´Ø§Ø¡ desktop file
        desktop_content = f"""[Desktop Entry]
Name={self.config['app_name']}
Comment={self.config['description']}
Exec=AppRun
Icon=icon
Type=Application
Categories=Utility;
Terminal=false
StartupNotify=true
"""
        
        (app_dir / f"{self.config['app_name']}.desktop").write_text(desktop_content)
        
        # Ø¥Ù†Ø´Ø§Ø¡ AppRun script
        apprun_content = """#!/bin/bash
HERE="$(dirname "$(readlink -f "${0}")")"
exec "$HERE/usr/bin/AppRun" "$@"
"""
        
        (app_dir / "AppRun").write_text(apprun_content)
        os.chmod(app_dir / "AppRun", 0o755)
        
        self.color_print("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙŠÙƒÙ„ AppImage", "GREEN")
    
    def create_deb_package(self, build_dir: Path):
        """Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© DEB Ù„Ù€ Linux"""
        self.color_print("ğŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© DEB...", "BLUE")
        
        deb_dir = build_dir / "deb"
        deb_dir.mkdir(exist_ok=True)
        
        # Ù‡ÙŠÙƒÙ„ Ø­Ø²Ù…Ø© DEB
        control_content = f"""Package: {self.config['app_name'].lower().replace(' ', '-')}
Version: {self.config['version']}
Section: utils
Priority: optional
Architecture: amd64
Depends: python3
Maintainer: {self.config['author']}
Description: {self.config['description']}
 {self.config['app_name']} - ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø§ÙŠØ«ÙˆÙ† Ù…ØªØ¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØµØ§Øª
"""
        
        (deb_dir / "DEBIAN").mkdir(exist_ok=True)
        (deb_dir / "DEBIAN" / "control").write_text(control_content)
        
        self.color_print("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø­Ø²Ù…Ø© DEB (ØªØ¬Ø±ÙŠØ¨ÙŠØ©)", "GREEN")
    
    def create_windows_msi(self, build_dir: Path):
        """Ø¥Ù†Ø´Ø§Ø¡ MSI installer Ù„Ù€ Windows"""
        self.color_print("ğŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ MSI installer...", "BLUE")
        # ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ WiX Toolset Ù„Ù‡Ø°Ø§
        
    def create_macos_dmg(self, build_dir: Path):
        """Ø¥Ù†Ø´Ø§Ø¡ DMG Ù„Ù€ macOS"""
        self.color_print("ğŸ“¦ Ø¥Ù†Ø´Ø§Ø¡ DMG image...", "BLUE")
        # ØªØ­ØªØ§Ø¬ Ø¥Ù„Ù‰ hdiutil Ø¹Ù„Ù‰ macOS
    
    def build_all(self):
        """Ø¨Ù†Ø§Ø¡ Ù„ÙƒÙ„ Ø§Ù„Ø£Ù†Ø¸Ù…Ø© Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©"""
        self.color_print("=" * 60, "MAGENTA")
        self.color_print(f"ğŸš€ Universal App Builder v1.0", "BOLD")
        self.color_print(f"ğŸ“± Ø¨Ù†Ø§Ø¡: {self.config['app_name']} v{self.config['version']}", "BOLD")
        self.color_print("=" * 60, "MAGENTA")
        
        # Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª
        self.color_print("\nğŸ” Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ¨Ø¹ÙŠØ§Øª...", "CYAN")
        missing = self.check_dependencies()
        
        if missing:
            self.color_print(f"âš ï¸  Ø£Ø¯ÙˆØ§Øª Ù…ÙÙ‚ÙˆØ¯Ø©: {', '.join(missing)}", "YELLOW")
            install = input("ğŸ“¦ Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ«Ø¨ÙŠØªÙ‡Ø§ØŸ (y/n): ").lower()
            if install == 'y':
                self.install_dependencies(missing)
        
        # Ø¨Ù†Ø§Ø¡ Ù„ÙƒÙ„ Ù†Ø¸Ø§Ù…
        results = {}
        
        for target in self.config["build_targets"]:
            self.color_print(f"\n{'='*50}", "CYAN")
            self.color_print(f"ğŸ—ï¸  Ø§Ù„Ø¨Ø¯Ø¡ ÙÙŠ Ø¨Ù†Ø§Ø¡ {target.upper()}...", "BOLD")
            
            if target == "windows":
                results["windows"] = self.build_for_windows()
            elif target == "linux":
                results["linux"] = self.build_for_linux()
            elif target == "android":
                results["android"] = self.build_for_android()
            elif target == "macos":
                results["macos"] = self.build_for_macos()
            elif target == "web":
                results["web"] = self.build_for_web()
        
        # Ø¹Ø±Ø¶ Ø§Ù„Ù†ØªØ§Ø¦Ø¬
        self.color_print("\n" + "=" * 60, "GREEN")
        self.color_print("ğŸ“Š Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ø¨Ù†Ø§Ø¡:", "BOLD")
        
        for target, success in results.items():
            status = "âœ… Ù†Ø¬Ø§Ø­" if success else "âŒ ÙØ´Ù„"
            self.color_print(f"{target.upper():10} {status}", "GREEN" if success else "RED")
        
        self.color_print("\nğŸ“ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ: build/", "BLUE")
        self.color_print("ğŸ‰ ØªÙ… Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡ Ù…Ù† Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨Ù†Ø§Ø¡!", "BOLD")
        
        return all(results.values())
    
    def create_installer_script(self):
        """Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙƒØ±ÙŠØ¨Øª ØªØ«Ø¨ÙŠØª Ø³Ø±ÙŠØ¹"""
        install_content = """#!/bin/bash
# Universal Python App Installer
# Ù‡Ø°Ø§ Ø§Ù„Ù…Ù„Ù ÙŠÙˆÙ„Ø¯ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹

echo "ğŸš€ Universal Python App Installer"
echo "================================="

# ØªØ­Ø¯ÙŠØ¯ Ø§Ù„Ù†Ø¸Ø§Ù…
OS=$(uname -s)
case "$OS" in
    Linux*)     OS_NAME="linux" ;;
    Darwin*)    OS_NAME="macos" ;;
    CYGWIN*)    OS_NAME="windows" ;;
    MINGW*)     OS_NAME="windows" ;;
    *)          OS_NAME="unknown" ;;
esac

echo "ğŸ“± Ø§Ù„Ù†Ø¸Ø§Ù… Ø§Ù„Ù…ÙƒØªØ´Ù: $OS_NAME"

# ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù…Ù†Ø§Ø³Ø¨
APP_NAME="{{APP_NAME}}"
VERSION="{{VERSION}}"

case "$OS_NAME" in
    "linux")
        echo "ğŸ“¥ ØªÙ†Ø²ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ Linux..."
        # Ø£Ø¶Ù Ø±ÙˆØ§Ø¨Ø· Ø§Ù„ØªÙ†Ø²ÙŠÙ„ Ù‡Ù†Ø§
        ;;
    "windows")
        echo "ğŸ“¥ ØªÙ†Ø²ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ Windows..."
        ;;
    "macos")
        echo "ğŸ“¥ ØªÙ†Ø²ÙŠÙ„ ØªØ·Ø¨ÙŠÙ‚ macOS..."
        ;;
    *)
        echo "âŒ Ù†Ø¸Ø§Ù… ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…"
        exit 1
        ;;
esac

echo "âœ… ØªÙ… Ø§Ù„ØªØ«Ø¨ÙŠØª Ø¨Ù†Ø¬Ø§Ø­!"
"""
        
        # Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
        install_content = install_content.replace("{{APP_NAME}}", self.config['app_name'])
        install_content = install_content.replace("{{VERSION}}", self.config['version'])
        
        install_path = self.project_root / "install.sh"
        install_path.write_text(install_content)
        os.chmod(install_path, 0o755)
        
        self.color_print("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙƒØ±ÙŠØ¨Øª Ø§Ù„ØªØ«Ø¨ÙŠØª: install.sh", "GREEN")

def main():
    """Ø§Ù„Ø¯Ø§Ù„Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©"""
    builder = UniversalAppBuilder()
    
    # Ø¹Ø±Ø¶ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    builder.color_print("\nğŸ¯ Universal Python App Builder", "BOLD")
    builder.color_print("Ø£Ø¯Ø§Ø© ØªØ­ÙˆÙŠÙ„ Ø£ÙŠ ÙƒÙˆØ¯ Ø¨Ø§ÙŠØ«ÙˆÙ† Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„ÙƒÙ„ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©", "CYAN")
    
    print("\nğŸ“‹ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª:")
    print("1. Ø¨Ù†Ø§Ø¡ ÙƒÙ„ Ø§Ù„Ø£Ù†Ø¸Ù…Ø©")
    print("2. Ø¨Ù†Ø§Ø¡ Ù„Ù†Ø¸Ø§Ù… Ù…Ø­Ø¯Ø¯")
    print("3. Ø¥Ù†Ø´Ø§Ø¡ Ù…Ù„ÙØ§Øª Ø§Ù„Ø¨Ù†Ø§Ø¡ ÙÙ‚Ø·")
    print("4. Ø¥Ù†Ø´Ø§Ø¡ Ø³ÙƒØ±ÙŠØ¨Øª ØªØ«Ø¨ÙŠØª")
    print("5. Ø®Ø±ÙˆØ¬")
    
    try:
        choice = input("\nğŸ‘‰ Ø§Ø®ØªØ± Ø±Ù‚Ù… [1-5]: ").strip()
        
        if choice == "1":
            builder.build_all()
        elif choice == "2":
            print("\nğŸ¯ Ø§Ø®ØªØ± Ø§Ù„Ù†Ø¸Ø§Ù…:")
            print("1. Windows (.exe)")
            print("2. Linux (.AppImage)")
            print("3. Android (.apk)")
            print("4. macOS (.app)")
            print("5. Web (Streamlit)")
            
            os_choice = input("ğŸ‘‰ Ø§Ø®ØªØ± Ø±Ù‚Ù…: ").strip()
            
            if os_choice == "1":
                builder.build_for_windows()
            elif os_choice == "2":
                builder.build_for_linux()
            elif os_choice == "3":
                builder.build_for_android()
            elif os_choice == "4":
                builder.build_for_macos()
            elif os_choice == "5":
                builder.build_for_web()
        
        elif choice == "3":
            builder.create_project_structure()
            builder.color_print("âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹", "GREEN")
        
        elif choice == "4":
            builder.create_installer_script()
        
        elif choice == "5":
            builder.color_print("ğŸ‘‹ Ù…Ø¹ Ø§Ù„Ø³Ù„Ø§Ù…Ø©!", "CYAN")
            return
        
    except KeyboardInterrupt:
        builder.color_print("\nğŸ‘‹ ØªÙ… Ø§Ù„Ø¥Ù„ØºØ§Ø¡", "YELLOW")
    except Exception as e:
        builder.color_print(f"âŒ Ø®Ø·Ø£: {e}", "RED")

if __name__ == "__main__":
    main()
